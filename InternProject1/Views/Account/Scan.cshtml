@{
    ViewData["Title"] = "Scan QR Code";
}

<div class="container text-center mt-5">
    <h2>Scan to Clock-In</h2>
    <p class="text-muted">Point your camera at the TimeVIA QR Code</p>

    <div id="reader" class="mx-auto" style="max-width: 500px; border: 2px solid #007bff; border-radius: 10px; overflow: hidden;"></div>

    <div id="result" class="mt-3"></div>

    <a asp-action="Login" class="btn btn-secondary mt-4">Back to Login</a>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>
    function onScanSuccess(decodedText, decodedResult) {
        // Stop the camera once a scan is successful
        html5QrcodeScanner.clear();

        // Show a loading message
        document.getElementById('result').innerHTML = '<span class="badge bg-success">Code detected! Redirecting...</span>';

        // Redirect to the URL hidden in the QR Code (The AutoLogin method)
        window.location.href = decodedText;
    }

    function onScanFailure(error) {
        // We usually leave this empty so it doesn't spam errors while searching for a code
    }

    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader",
        {
            fps: 10,
            qrbox: { width: 250, height: 250 },
            rememberLastUsedCamera: true,
            supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
        }
    );

    html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>